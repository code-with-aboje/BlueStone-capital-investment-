<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crest Point Support</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #f8fafc; height: 100vh; overflow: hidden; }
        
        .chat-container { display: flex; flex-direction: column; height: 100%; background: white; max-width: 100%; margin: 0 auto; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 24px; display: flex; flex-direction: column; gap: 16px; background: #f8fafc; }
        .chat-messages::-webkit-scrollbar { width: 6px; }
        .chat-messages::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        
        .message { display: flex; gap: 12px; max-width: 70%; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message.user { align-self: flex-end; flex-direction: row-reverse; }
        .message.bot { align-self: flex-start; }
        
        .message-content { display: flex; flex-direction: column; gap: 4px; width: 100%; }
        .message-bubble { padding: 14px 18px; border-radius: 18px; font-size: 14px; line-height: 1.6; }
        .message.bot .message-bubble { background: white; color: #1e293b; border: 1px solid #e2e8f0; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .message.user .message-bubble { background: #10b981; color: white; border-bottom-right-radius: 4px; margin-left: auto; }
        .message-time { font-size: 11px; color: #94a3b8; padding: 0 4px; }
        .message.user .message-time { text-align: right; }
        
        .typing-indicator { display: flex; gap: 4px; padding: 14px 18px; background: white; border: 1px solid #e2e8f0; border-radius: 18px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .typing-dot { width: 8px; height: 8px; border-radius: 50%; background: #94a3b8; animation: bounce 1.4s infinite; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-8px); } }
        
        .welcome-screen { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 24px; text-align: center; gap: 24px; background: #f8fafc; }
        .welcome-screen.hidden { display: none; }
        .welcome-icon { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #10b981 0%, #059669 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 36px; box-shadow: 0 8px 24px rgba(16, 185, 129, 0.2); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .welcome-title { font-size: 28px; font-weight: 700; color: #0f172a; margin-bottom: 8px; }
        .welcome-subtitle { font-size: 15px; color: #64748b; max-width: 400px; line-height: 1.5; }
        
        .chat-input-container { padding: 20px 24px; background: white; border-top: 1px solid #e5e7eb; }
        .chat-input-wrapper { display: flex; gap: 12px; align-items: flex-end; max-width: 100%; margin: 0 auto; }
        .chat-input { flex: 1; padding: 14px 18px; border: 2px solid #e2e8f0; border-radius: 24px; font-size: 14px; font-family: 'Inter', sans-serif; resize: none; max-height: 120px; min-height: 48px; transition: all 0.3s ease; }
        .chat-input:focus { outline: none; border-color: #10b981; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); }
        .chat-input::placeholder { color: #94a3b8; }
        
        .send-button { width: 48px; height: 48px; border-radius: 24px; background: #10b981; color: white; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: all 0.3s ease; flex-shrink: 0; }
        .send-button:hover:not(:disabled) { background: #059669; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
        .send-button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .error-message { color: #ef4444; font-size: 13px; padding: 8px 12px; background: #fee2e2; border-radius: 8px; margin-top: 8px; }
        
        @media (max-width: 768px) {
            .chat-messages { padding: 16px; }
            .message { max-width: 85%; }
            .welcome-icon { width: 64px; height: 64px; font-size: 28px; }
            .welcome-title { font-size: 24px; }
            .chat-input-container { padding: 16px; }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="welcome-screen" id="welcome">
            <div class="welcome-icon"><i class="fas fa-comments"></i></div>
            <div>
                <div class="welcome-title">Welcome to Crest Point Support</div>
                <div class="welcome-subtitle">Ask me anything about investments, account management, or how to get started with Crest Point</div>
            </div>
        </div>

        <div class="chat-messages" id="msgs"></div>

        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <textarea class="chat-input" id="input" placeholder="Type your message here..." rows="1"></textarea>
                <button class="send-button" id="send"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <script>
        const msgs = document.getElementById('msgs');
        const input = document.getElementById('input');
        const send = document.getElementById('send');
        const welcome = document.getElementById('welcome');
        
        let conversationHistory = [];

        input.oninput = function() { this.style.height = 'auto'; this.style.height = Math.min(this.scrollHeight, 120) + 'px'; };
        send.onclick = () => { if (input.value.trim()) ask(input.value.trim()); };
        input.onkeydown = (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); if (input.value.trim()) ask(input.value.trim()); } };

        async function ask(txt) {
            welcome.classList.add('hidden');
            addMsg(txt, 'user');
            input.value = '';
            input.style.height = 'auto';
            
            conversationHistory.push({ role: 'user', content: txt });
            
            showTyping();
            send.disabled = true;
            input.disabled = true;
            
            try {
                const response = await fetch('/api/groq-chat.js', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: txt,
                        history: conversationHistory 
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                hideTyping();
                
                if (data.error) {
                    addMsg('Sorry, I encountered an error. Please try again.', 'bot');
                    showError(data.error);
                } else {
                    addMsg(data.response, 'bot');
                    conversationHistory.push({ role: 'assistant', content: data.response });
                }
            } catch (error) {
                hideTyping();
                console.error('Error:', error);
                addMsg('Sorry, I\'m having trouble connecting. Please check your internet connection and try again.', 'bot');
                showError(error.message);
            } finally {
                send.disabled = false;
                input.disabled = false;
                input.focus();
            }
        }

        function addMsg(txt, type) {
            const m = document.createElement('div');
            m.className = `message ${type}`;
            m.innerHTML = `
                <div class="message-content">
                    <div class="message-bubble">${txt}</div>
                    <div class="message-time">${new Date().toLocaleTimeString('en-US', {hour: 'numeric', minute: '2-digit', hour12: true})}</div>
                </div>`;
            msgs.appendChild(m);
            msgs.scrollTop = msgs.scrollHeight;
        }

        function showTyping() {
            const t = document.createElement('div');
            t.className = 'message bot';
            t.id = 'typing';
            t.innerHTML = `
                <div class="typing-indicator">
                    <div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>
                </div>`;
            msgs.appendChild(t);
            msgs.scrollTop = msgs.scrollHeight;
        }

        function hideTyping() { 
            document.getElementById('typing')?.remove(); 
        }
        
        function showError(msg) {
            const existingError = document.querySelector('.error-message');
            if (existingError) existingError.remove();
            
            const err = document.createElement('div');
            err.className = 'error-message';
            err.textContent = `Error: ${msg}`;
            msgs.appendChild(err);
            msgs.scrollTop = msgs.scrollHeight;
            
            setTimeout(() => err.remove(), 5000);
        }
    </script>
</body>
</html>
